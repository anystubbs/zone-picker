<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone Selector Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #map-canvas {
            border: 1px solid #ccc;
            margin: 20px 0;
        }
        .controls {
            margin: 20px 0;
        }
        .controls button {
            margin-right: 10px;
            padding: 8px 16px;
            cursor: pointer;
        }
        .controls button.active {
            background-color: #0066cc;
            color: white;
        }
        .selected-zones {
            margin-top: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        .zone-list {
            list-style: none;
            padding: 0;
        }
        .zone-list li {
            padding: 4px 8px;
            margin: 2px 0;
            background-color: white;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <h1>Zone Selector Library Demo</h1>
    
    <div class="controls">
        <h3>Categories:</h3>
        <div id="category-buttons">
            <!-- Buttons will be generated dynamically -->
        </div>
        
        <h3>Drag Mode:</h3>
        <div id="drag-mode-buttons">
            <button id="rectangle-mode" onclick="setDragMode('rectangle')">Rectangle Selection</button>
            <button id="lasso-mode" onclick="setDragMode('lasso')">Lasso Selection</button>
            <button id="path-mode" onclick="setDragMode('path')">Path Intersection</button>
        </div>
    </div>
    
    <canvas id="map-canvas" width="800" height="600"></canvas>
    
    <button onclick="clearSelection()">Clear All Selections</button>
    
    <div class="selected-zones">
        <h3>Selected Zones:</h3>
        <ul id="selected-list" class="zone-list">
            <!-- Selected zones will appear here -->
        </ul>
    </div>

    <script type="module">
        import { ZoneSelector } from '../dist/index.esm.js';
        import { seedZones, viewportBounds } from './demoData.js';

        // Use real hexagon data
        const sampleZones = [
            {
                id: 'territory-1',
                name: 'North Territory',
                category: 'Sales Territories',
                geometry: {
                    type: 'Polygon',
                    coordinates: [[100, 100], [200, 100], [200, 200], [100, 200], [100, 100]]
                },
                selected: false
            },
            {
                id: 'territory-2',
                name: 'South Territory',
                category: 'Sales Territories',
                geometry: {
                    type: 'Polygon',
                    coordinates: [[300, 300], [400, 300], [400, 400], [300, 400], [300, 300]]
                },
                selected: false
            },
            {
                id: 'delivery-1',
                name: 'Downtown Delivery',
                category: 'Delivery Zones',
                geometry: {
                    type: 'Point',
                    coordinates: [150, 150]
                },
                selected: false
            },
            {
                id: 'delivery-2',
                name: 'Suburb Delivery',
                category: 'Delivery Zones',
                geometry: {
                    type: 'Point',
                    coordinates: [350, 350]
                },
                selected: false
            },
            {
                id: 'marketing-1',
                name: 'Urban Marketing Zone',
                category: 'Marketing Regions',
                geometry: {
                    type: 'Polygon',
                    coordinates: [[50, 50], [250, 50], [250, 250], [50, 250], [50, 50]]
                },
                selected: false
            }
        ];

        // Get canvas element
        const canvas = document.getElementById('map-canvas');
        
        // Initialize zone selector
        let zoneSelector;
        
        function initZoneSelector() {
            zoneSelector = new ZoneSelector({
                canvas: canvas,
                zones: seedZones,
                viewport: viewportBounds,
                dragMode: 'rectangle', // Default to rectangle mode
                onSelectionChange: updateSelectedZones,
                onCategoryChange: updateActiveCategory
            });
            
            // Generate category buttons
            generateCategoryButtons();
            
            // Set initial drag mode button state
            document.getElementById('rectangle-mode').classList.add('active');
        }

        function generateCategoryButtons() {
            const buttonContainer = document.getElementById('category-buttons');
            const categories = zoneSelector.getCategories();
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.onclick = () => {
                    zoneSelector.setCategory(category);
                };
                
                if (category === zoneSelector.getCurrentCategory()) {
                    button.classList.add('active');
                }
                
                buttonContainer.appendChild(button);
            });
        }

        function updateSelectedZones(selectedZones) {
            const list = document.getElementById('selected-list');
            list.innerHTML = '';
            
            selectedZones.forEach(zone => {
                const li = document.createElement('li');
                li.textContent = `${zone.name} (${zone.category})`;
                list.appendChild(li);
            });
        }

        function updateActiveCategory(category) {
            // Update button states
            const buttons = document.querySelectorAll('#category-buttons button');
            buttons.forEach(button => {
                button.classList.toggle('active', button.textContent === category);
            });
        }

        window.clearSelection = function() {
            zoneSelector.clearSelection();
        };

        window.setDragMode = function(mode) {
            zoneSelector.setDragMode(mode);
            
            // Update button states
            const buttons = document.querySelectorAll('#drag-mode-buttons button');
            buttons.forEach(button => {
                button.classList.toggle('active', button.id === mode + '-mode');
            });
        };

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('Page loaded, initializing...');
            initZoneSelector();
        });
    </script>
</body>
</html>